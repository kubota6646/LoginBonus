# LoginBonus バージョン 1.4.1 変更点

## リリース日
2026年2月

## 更新内容

### マルチバージョン対応

#### 概要
Minecraft 1.12から1.21.11までの全てのバージョンに対応しました。

#### 変更内容

1. **API バージョンの調整**
   - `plugin.yml`: api-version を 1.21 から 1.13 に変更
   - これにより、Minecraft 1.12～1.21.11までの幅広いバージョンで動作可能に

2. **互換性の確保**
   - 既存のコードは標準的なBukkit APIのみを使用しているため、変更不要
   - Material.getMaterial() による動的なアイテム取得により、バージョンに応じたアイテムを自動判定
   - 存在しないアイテムはnullチェックでスキップされ、警告を表示

3. **Plan連携の修正**
   - Plan プラグインが存在しない環境でもプラグインが正常にロードされるように修正
   - PlanHookクラスを導入し、リフレクションを使用してPlan APIを呼び出すように変更
   - これにより、NoClassDefFoundError が発生しなくなりました

4. **Java互換性の修正**
   - コンパイルターゲットをJava 17からJava 8に変更
   - これにより、古いMinecraftサーバーでも動作可能に（class file major version 52）
   - Java 8以上のすべてのバージョンで動作します

5. **ドキュメントの更新**
   - README.md の互換性セクションを更新
   - 古いバージョンでは利用できないアイテム（NETHERITE_INGOT等）に関する注意を追加

## バージョン更新
- `plugin.yml`: version 1.4.0 → 1.4.1, api-version 1.21 → 1.13
- `build.gradle`: version 1.4.0 → 1.4.1, Java 17 → Java 8

## 互換性

### サポート対象
- **Minecraftバージョン**: 1.12～1.21.11 (api-version: 1.13で幅広いバージョンをサポート)
- **Javaバージョン**: 8以上（Java 8で動作、Java 17でも動作確認済み）
- **Bukkit/Spigot/Paper**: 標準的なBukkit実装と互換
- **連携プラグイン**: Plan (Player Analytics) - オプション

### 以前のバージョンとの互換性
- **データ互換性**: 既存のプレイヤーデータ（YAML/SQLite/MySQL）はそのまま使用可能
- **設定互換性**: 既存の設定ファイル（config.yml、message.yml）の変更は不要
- **コマンド互換性**: すべてのコマンドとパーミッションは変更なし
- **API互換性**: 他のプラグインとのAPI互換性を維持

### バージョン別注意事項
- **Minecraft 1.12-1.15**: NETHERITE_INGOT等の新しいアイテムは使用できません。config.ymlで古いバージョンで利用可能なアイテムに変更してください。
- **Minecraft 1.16以降**: すべてのデフォルト設定のアイテムが利用可能です。

## アップグレード方法

### 通常のアップグレード
1. サーバーを停止
2. `plugins/` フォルダ内の古い LoginBonus JAR ファイルを削除
3. 新しい LoginBonus-1.4.1.jar を `plugins/` フォルダに配置
4. （オプション）古いMinecraftバージョンを使用している場合、config.ymlのアイテムを確認
5. サーバーを起動

### 重要な注意事項
- プラグインデータ（playerdata.yml、playerdata.db、MySQLデータベース）はバックアップ推奨
- 設定ファイルの変更は不要です（古いバージョンの場合はアイテム名の確認を推奨）
- 既存の機能はすべて動作します

## 動作確認済みの機能
- ログイン時間トラッキング
- 報酬システム
- ストリーク機能
- ボスバー表示
- データベース連携（YAML/SQLite/MySQL）
- 全コマンド（/rewardstreak、/rewardreload、etc.）
- 特別報酬システム（個別日数・倍数報酬）
- マルチサーバー同期（MySQL使用時）
- Plan連携（連続ログイン日数とランキング表示）

## 既知の問題
なし

## バグ修正
- **Plan連携のクラスロード問題を修正**: Planプラグインが存在しない環境で`NoClassDefFoundError`が発生する問題を修正しました。PlanHookクラスを導入し、リフレクションを使用することで、Planがインストールされていない環境でもプラグインが正常にロードされるようになりました。
- **Javaバージョン互換性を修正**: Java 17でコンパイルされていた問題を修正し、Java 8でコンパイルするように変更しました。これにより、古いMinecraftサーバー（Java 8以上で動作）でもプラグインが正常にロードされるようになりました（class file major version 61 → 52）。

## セキュリティ
- CodeQLスキャン実施予定
- 依存関係チェック予定
- コードレビュー実施予定

## 前バージョンからの変更点
- バージョン 1.4.0: Plan連携追加、バグ修正
- バージョン 1.4.1: マルチバージョン対応（1.12～1.21.11）

## 今後の予定
- 機能追加のフィードバック受付中
- バグ報告はGitHub Issuesへ

## 貢献者
- マルチバージョン対応実装: GitHub Copilot
